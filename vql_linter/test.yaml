name: Custom.Linux.Atos.Identification
description: |
   Unique)
   
   Uniquely identify host for further post-processing.
   Make collected .zip package standalone.
   
   Collects:
   - Hostname
   - Fqdn
   - HostID
   - LocalMachineTime
   - Operating System
   
   Not working:
   - Serial number of first HDDZeroSerial
   - Client ID
   
   OperatingSystem)
   Plugin to provide every information needed for OS identifaction for building volatility plugin.
     Notes:
     CSDVersion can be empty.
     
   VSS*)
   List VSS:
   - DeviceObject
   - InstallDate with timezone
   - Original partition letter
   - VolumeName
   - Name of VSS (Not working)
   
   Timezone)
   e.g. PDT
   
   ClientConfigurationFile)
   Parse client YAML for PostRaptor evidence routing (Dispatcher)
   

author: Piotr Mazurkiewicz / Michał Cichorz / Jarosław Oparka

type: CLIENT

precondition:
      SELECT OS From info() where OS = 'linux'

sources:
  - name: Unique
    query: |
        LET LocalMachineTime <= timestamp(epoch=now())
        SELECT *, LocalMachineTime, "Identification.Unique" AS __Source From info()

  - name: ProfileName

  - name: PackagePlatform
    query: |
      SELECT 'linux' AS PackagePlatform, "Identification.PackagePlatform" AS __Source  From scope()

  - name: Timezone
    query: |
        SELECT timestamp(epoch=1630414425).Zone AS Timezone, "Identification.Timezone" AS __Source FROM scope()

  - name: ClientConfigurationFile
    query: |
      LET velo_config_path <= SELECT OSPath FROM glob(globs="etc/velociraptor/{client,velociraptor}.config.yaml")
      SELECT parse_yaml(accessor="file", filename=velo_config_path[0].OSPath) AS ClientSideConfig, "Identification.ClientConfigurationFile" AS __Source FROM scope()    
